# Система логирования документов

## Обзор

В приложении реализована комплексная система логирования всех операций с документами, штрихкодами и пользователями. Все действия записываются в файл `logs/documents.log` с временными метками.

## Структура логов

### Формат записи
```
YYYY-MM-DD HH:MM:SS - СОДЕРЖИМОЕ СООБЩЕНИЯ
```

### Типы сообщений

#### 1. Запуск приложения
```
============================================================
ПРИЛОЖЕНИЕ ЗАПУЩЕНО
Время запуска: 2024-01-15 10:30:00
============================================================
```

#### 2. Инициализация
```
База данных инициализирована
Автоматически создан пользователь 'Администратор' в базе данных
```

#### 3. Аутентификация пользователей
```
Пользователь 'Иван Петров' (ID: 1) успешно вошел в систему
Неудачная попытка входа: пользователь 'Иван Петров' с неверным ПИН-кодом
```

#### 4. Создание документов
```
Создан новый документ: 'Инвентаризация' (ID: 1) для пользователя 'Иван Петров' (ID: 1) с комментарием: 'Проверка склада'
Пользователь Иван Петров (ID: 1) создал новый документ типа 'Инвентаризация' (ID: 1) с комментарием: 'Проверка склада'
```

#### 5. Работа со штрихкодами
```
Добавлен штрихкод '123456789' в документ 'Инвентаризация' (ID: 1) пользователя 'Иван Петров'
Пользователь Иван Петров (ID: 1) добавил штрихкод '123456789' в документ 'Инвентаризация' (ID: 1)
Удален штрихкод '123456789' из документа 'Инвентаризация' (ID: 1) пользователя 'Иван Петров'
```

#### 6. Закрытие документов
```
Документ 'Инвентаризация' (ID: 1) пользователя 'Иван Петров' закрыт
Пользователь Иван Петров (ID: 1) закрыл документ 'Инвентаризация' (ID: 1) с 15 штрихкодами
```

#### 7. Выгрузка документов (CSV)
```
=== ВЫГРУЖЕН ДОКУМЕНТ ===
Файл: Инвентаризация_Иван Петров_20240115_103000.csv
Пользователь: Иван Петров
Тип документа: Инвентаризация
Дата создания: 2024-01-15T10:30:00
Дата закрытия: 2024-01-15T11:45:00
Комментарий: Проверка склада
Количество штрихкодов: 15

СПИСОК ШТРИХКОДОВ:
  1. 123456789 (время сканирования: 10:31:15)
  2. 987654321 (время сканирования: 10:32:20)
  3. 456789123 (время сканирования: 10:33:45)
  ...
==================================================
```

#### 8. Удаление документов
```
Удален документ 'Инвентаризация' (ID: 1) пользователя 'Иван Петров' с 15 штрихкодами
Пользователь Иван Петров (ID: 1) удалил документ 'Инвентаризация' (ID: 1) с 15 штрихкодами. Комментарий: 'Проверка склада'
```

#### 9. Обновление комментариев
```
Обновлен комментарий к документу (ID: 1): 'Старый комментарий' -> 'Новый комментарий'
Пользователь Иван Петров (ID: 1) обновил комментарий к документу 'Инвентаризация' (ID: 1). Старый комментарий: 'Старый комментарий', новый комментарий: 'Новый комментарий'
```

#### 10. Админские операции
```
АДМИНИСТРАТОР admin (ID: 1) удалил документ 'Инвентаризация' (ID: 1) пользователя 'Иван Петров' с 15 штрихкодами. Комментарий: 'Проверка склада'
АДМИНИСТРАТОР admin (ID: 1) регенерировал CSV файл для документа 'Инвентаризация' (ID: 1) пользователя 'Иван Петров'
АДМИНИСТРАТОР admin (ID: 1) добавил нового пользователя: 'Новый Пользователь' с ПИН-кодом
АДМИНИСТРАТОР admin (ID: 1) удалил пользователя 'Новый Пользователь' (ID: 2) с 0 документами и 0 штрихкодами
АДМИНИСТРАТОР admin (ID: 1) загрузил новый логотип: company_logo.png (24576 байт)
```

#### 11. Управление пользователями
```
Добавлен новый пользователь в систему: 'Новый Пользователь' (ID: 2)
Пользователь 'Новый Пользователь' (ID: 2) удален из системы
```

#### 12. Системные события
```
Изменен язык интерфейса на: RU
Удален CSV файл: Инвентаризация_Иван Петров_20240115_103000.csv
```

## Файлы логов

### Основной лог
- **Путь**: `logs/documents.log`
- **Кодировка**: UTF-8
- **Формат**: Текстовый файл с временными метками

### Ротация логов
Логи накапливаются в одном файле. Для продакшена рекомендуется настроить ротацию логов.

## Настройка логирования

### Уровни логирования
- **INFO**: Обычные операции (создание, редактирование, удаление)
- **WARNING**: Неудачные попытки входа
- **ERROR**: Ошибки при логировании

### Конфигурация
Логирование настраивается в функции `setup_document_logging()`:
- Создание директории `logs/`
- Настройка формата времени
- Установка кодировки UTF-8
- Настройка уровня логирования

## Мониторинг и анализ

### Поиск по логам
```bash
# Поиск всех операций конкретного пользователя
grep "Иван Петров" logs/documents.log

# Поиск операций с документами
grep "документ" logs/documents.log

# Поиск админских операций
grep "АДМИНИСТРАТОР" logs/documents.log

# Поиск по дате
grep "2024-01-15" logs/documents.log
```

### Статистика операций
```bash
# Подсчет операций по типам
grep -c "добавил штрихкод" logs/documents.log
grep -c "закрыл документ" logs/documents.log
grep -c "удалил документ" logs/documents.log
```

## Безопасность

- Логи содержат только служебную информацию
- ПИН-коды не записываются в логи
- Логи доступны только администраторам системы
- Рекомендуется ограничить доступ к директории `logs/`

## Рекомендации

1. **Регулярная ротация**: Настройте автоматическую ротацию логов
2. **Мониторинг размера**: Следите за размером файла логов
3. **Резервное копирование**: Регулярно создавайте резервные копии логов
4. **Анализ активности**: Используйте логи для анализа активности пользователей
5. **Аудит безопасности**: Периодически проверяйте логи на подозрительную активность

## Примеры использования

### Отслеживание активности пользователя
```bash
grep "Иван Петров" logs/documents.log | tail -20
```

### Анализ популярных типов документов
```bash
grep "создал новый документ" logs/documents.log | cut -d"'" -f4 | sort | uniq -c
```

### Мониторинг админских операций
```bash
grep "АДМИНИСТРАТОР" logs/documents.log | tail -10
```
