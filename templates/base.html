<!DOCTYPE html>
<html lang="ru" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0d6efd">
    <meta name="msapplication-navbutton-color" content="#0d6efd">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>{% block title %}Мобильная инвентаризация{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="manifest" href="/static/manifest.json">
    {% block styles %}{% endblock %}
    <style>
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #0dcaf0;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --border-radius: 0.75rem;
            --box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            --box-shadow-lg: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }

        [data-bs-theme="dark"] {
            --primary-color: #0d6efd;
            --light-color: #212529;
            --dark-color: #f8f9fa;
            --box-shadow: 0 0.125rem 0.25rem rgba(255, 255, 255, 0.075);
            --box-shadow-lg: 0 0.5rem 1rem rgba(255, 255, 255, 0.15);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding-bottom: env(safe-area-inset-bottom);
            padding-top: env(safe-area-inset-top);
        }

        .navbar {
            box-shadow: var(--box-shadow);
            padding: 0.75rem 0;
            position: sticky;
            top: 0;
            z-index: 1030;
        }

        .navbar-brand {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .logo-svg {
            width: 32px;
            height: 32px;
            margin-right: 0.5rem;
            color: currentColor;
        }

        .card {
            border: none;
            box-shadow: var(--box-shadow);
            border-radius: var(--border-radius);
            transition: all 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow-lg);
        }

        .btn {
            border-radius: var(--border-radius);
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            transition: all 0.2s ease;
        }

        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        .form-control, .form-select {
            border-radius: var(--border-radius);
            border: 2px solid transparent;
            background-color: var(--bs-body-bg);
            transition: all 0.2s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }

        .scanner-input {
            font-size: 1.2rem;
            padding: 1rem;
            font-family: 'Courier New', monospace;
        }

        .barcode-item {
            border-left: 4px solid var(--primary-color);
            background-color: rgba(13, 110, 253, 0.05);
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            transition: all 0.2s ease;
        }

        .barcode-item:hover {
            background-color: rgba(13, 110, 253, 0.1);
        }

        .theme-toggle {
            border: none;
            background: none;
            color: inherit;
            font-size: 1.2rem;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .stats-card {
            text-align: center;
            padding: 1.5rem;
        }

        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
        }

        /* Мобильная навигация в верхней части */
        .navbar .btn-outline-light {
            border-color: rgba(255, 255, 255, 0.5);
            color: rgba(255, 255, 255, 0.9);
            transition: all 0.2s ease;
        }

        .navbar .btn-outline-light:hover {
            border-color: rgba(255, 255, 255, 0.8);
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Старая нижняя навигация - скрываем на мобильных */
        .mobile-nav {
            display: none !important;
        }

        /* Мобильная адаптация для разрешения 2340x1080 */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
                max-width: 100%;
            }
            
            .card {
                margin-bottom: 0.75rem;
                border-radius: 0.5rem;
            }
            
            .btn {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .btn-lg {
                padding: 1rem 1.5rem;
                font-size: 1rem;
            }
            
            .navbar-brand {
                font-size: 0.9rem;
            }
            
            .logo-svg {
                width: 24px;
                height: 24px;
            }
            
            .stats-number {
                font-size: 1.8rem;
            }
            
            main {
                padding-bottom: 1rem;
                margin-top: 1rem;
            }
            
            .table-responsive {
                font-size: 0.85rem;
            }



            /* Скрываем нижнюю навигацию */
            .mobile-nav {
                display: none !important;
            }

            /* Уменьшаем отступы для мобильных */
            .row {
                margin-left: -0.25rem;
                margin-right: -0.25rem;
            }

            .col, .col-1, .col-2, .col-3, .col-4, .col-5, .col-6, .col-7, .col-8, .col-9, .col-10, .col-11, .col-12 {
                padding-left: 0.25rem;
                padding-right: 0.25rem;
            }
        }

        /* Специальная адаптация для разрешения 2340x1080 */
        @media (min-width: 400px) and (max-width: 500px) {
            .navbar .btn-outline-light {
                padding: 0.4rem 0.6rem;
                font-size: 0.9rem;
            }
        }

        /* Улучшения для touch-устройств */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 48px;
            }
            
            .form-control, .form-select {
                min-height: 48px;
            }
            
            .nav-link {
                min-height: 48px;
            }

            .theme-toggle {
                min-width: 44px;
                min-height: 44px;
            }
        }

        /* Анимации */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Стили для полноэкранного режима */
        .fullscreen-mode .navbar {
            /* Не скрываем полностью, а делаем компактным */
            padding: 0.25rem 0;
            min-height: 50px;
        }
        
        .fullscreen-mode .navbar-brand {
            font-size: 0.9rem;
        }
        
        .fullscreen-mode .theme-toggle {
            padding: 0.25rem;
            font-size: 1rem;
        }
        
        /* В полноэкранном режиме показываем только кнопку выхода */
        .fullscreen-mode .d-md-none .btn:not([title="Выход"]) {
            display: none;
        }
        
        .fullscreen-mode .d-md-none .btn[title="Выход"] {
            background-color: rgba(220, 53, 69, 0.95);
            border-color: rgba(220, 53, 69, 0.95);
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 16px rgba(220, 53, 69, 0.4);
            transform: scale(1.1);
            transition: all 0.3s ease;
        }
        
        .fullscreen-mode .d-md-none .btn[title="Выход"]:hover {
            background-color: rgba(220, 53, 69, 1);
            border-color: rgba(220, 53, 69, 1);
            transform: scale(1.15);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.5);
        }
        
        /* Стили для кнопки выхода в верхней навигации при наведении */
        .navbar .btn-outline-danger:hover {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }
        
        /* Стили для кнопки выхода в полноэкранном режиме при наведении */
        .fullscreen-mode .d-md-none .btn[title="Выход"]:hover {
            background-color: rgba(220, 53, 69, 1);
            border-color: rgba(220, 53, 69, 1);
            transform: scale(1.15);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.5);
        }
        
        /* Стили для кнопки выхода в полноэкранном режиме при наведении */
        .fullscreen-mode .d-md-none .btn[title="Выход"]:active {
            transform: scale(1.05);
            box-shadow: 0 4px 16px rgba(220, 53, 69, 0.4);
        }
        
        /* Стили для кнопки выхода в полноэкранном режиме при наведении */
        .fullscreen-mode .d-md-none .btn[title="Выход"]:focus {
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }
        
        /* Стили для кнопки выхода в полноэкранном режиме при наведении */
        .fullscreen-mode .d-md-none .btn[title="Выход"]:focus-visible {
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }
        
        /* Стили для кнопки выхода в полноэкранном режиме при наведении */
        .fullscreen-mode .d-md-none .btn[title="Выход"]:focus-within {
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }
        

        
        /* Общие стили для кнопки выхода */
        .btn-outline-danger {
            border-width: 2px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-outline-danger:hover {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }
        
        /* Стили для кнопки выхода в нижней навигации */
        .mobile-nav .nav-link.text-danger:hover {
            background-color: rgba(220, 53, 69, 0.1);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.2);
        }
        




        .fullscreen-mode main {
            margin-top: 0;
            padding-top: 0;
        }

        /* Индикатор полноэкранного режима */
        .fullscreen-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.5rem;
            border-radius: 50%;
            z-index: 9999;
            display: none;
            cursor: pointer;
        }

        .fullscreen-mode .fullscreen-indicator {
            display: block;
        }

        /* PWA режим - дополнительные стили */
        .pwa-mode {
            /* Принудительно поддерживаем полноэкранный режим в PWA */
            overflow: hidden;
        }
        
        .pwa-mode .fullscreen-indicator {
            display: none !important;
        }
        
        .pwa-mode .navbar {
            /* В PWA режиме делаем навигацию еще более компактной */
            padding: 0.15rem 0;
            min-height: 45px;
        }
        
        .pwa-mode .navbar-brand {
            font-size: 0.8rem;
        }
        
        .pwa-mode .theme-toggle {
            padding: 0.2rem;
            font-size: 0.9rem;
        }
        

        
        /* Скрываем кнопку полноэкранного режима в PWA */
        .pwa-mode button[onclick="toggleFullscreen()"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            width: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
            position: absolute !important;
            left: -9999px !important;
        }
        
        .pwa-mode .theme-toggle[onclick="toggleFullscreen()"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            width: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
            position: absolute !important;
            left: -9999px !important;
        }
        
        /* Дополнительное правило для скрытия кнопки полноэкранного режима */
        .pwa-mode button[onclick*="toggleFullscreen"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            width: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
            position: absolute !important;
            left: -9999px !important;
        }
        
        /* Дополнительные правила для скрытия кнопки полноэкранного режима */
        .pwa-mode .theme-toggle[onclick*="toggleFullscreen"],
        .pwa-mode button[onclick*="toggleFullscreen"],
        .pwa-mode .fullscreen-toggle {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            width: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
            position: absolute !important;
            left: -9999px !important;
            clip: rect(0, 0, 0, 0) !important;
        }
        
        /* Специальное правило для кнопки с точным onclick="toggleFullscreen()" */
        .pwa-mode button[onclick="toggleFullscreen()"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            width: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
            position: absolute !important;
            left: -9999px !important;
            clip: rect(0, 0, 0, 0) !important;
            pointer-events: none !important;
        }
        
        /* Дополнительные правила для скрытия кнопки полноэкранного режима */
        .pwa-mode .theme-toggle[onclick*="toggleFullscreen"],
        .pwa-mode button[onclick*="toggleFullscreen"],
        .pwa-mode .fullscreen-toggle,
        .pwa-mode .fullscreen-btn {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            width: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
            position: absolute !important;
            left: -9999px !important;
            clip: rect(0, 0, 0, 0) !important;
            pointer-events: none !important;
            font-size: 0 !important;
            line-height: 0 !important;
        }
        
        /* Дополнительные правила для скрытия кнопки полноэкранного режима с максимальной специфичностью */
        .pwa-mode .navbar .container .d-flex .theme-toggle[onclick="toggleFullscreen()"],
        .pwa-mode .navbar .container .d-flex .theme-toggle[onclick*="toggleFullscreen"],
        .pwa-mode .navbar .container .d-flex button[onclick="toggleFullscreen()"],
        .pwa-mode .navbar .container .d-flex button[onclick*="toggleFullscreen"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            width: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
            position: absolute !important;
            left: -9999px !important;
            clip: rect(0, 0, 0, 0) !important;
            pointer-events: none !important;
            font-size: 0 !important;
            line-height: 0 !important;
            z-index: -9999 !important;
        }
        
        /* Дополнительные правила для скрытия кнопки полноэкранного режима с максимальной специфичностью */
        .pwa-mode .navbar .container .d-flex .theme-toggle[onclick="toggleFullscreen()"],
        .pwa-mode .navbar .container .d-flex .theme-toggle[onclick*="toggleFullscreen"],
        .pwa-mode .navbar .container .d-flex button[onclick="toggleFullscreen()"],
        .pwa-mode .navbar .container .d-flex button[onclick*="toggleFullscreen"],
        .pwa-mode .navbar .container .d-flex .theme-toggle[onclick="toggleFullscreen()"],
        .pwa-mode .navbar .container .d-flex .theme-toggle[onclick*="toggleFullscreen"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            width: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
            position: absolute !important;
            left: -9999px !important;
            clip: rect(0, 0, 0, 0) !important;
            pointer-events: none !important;
            font-size: 0 !important;
            line-height: 0 !important;
            z-index: -9999 !important;
            transform: scale(0) !important;
            transform-origin: center !important;
        }
        
        /* В PWA режиме скрываем индикатор полноэкранного режима */
        .pwa-mode .fullscreen-indicator {
            display: none !important;
        }
        
        /* В PWA режиме показываем все содержимое */
        .pwa-mode .barcode-list,
        .pwa-mode .barcode-item,
        .pwa-mode .stats-cards,
        .pwa-mode .card {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* Дополнительные стили для PWA режима */
        .pwa-mode .container {
            /* В PWA режиме используем максимальную ширину */
            max-width: 100%;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }
        
        .pwa-mode main {
            /* В PWA режиме уменьшаем отступы */
            margin-top: 0.5rem;
            padding-bottom: 0.5rem;
        }
        
        /* Предотвращаем выход из полноэкранного режима в PWA */
        .pwa-mode.fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Дополнительные стили для мобильных устройств в PWA режиме */
        @media (max-width: 768px) {
            .pwa-mode .navbar {
                padding: 0.1rem 0;
                min-height: 40px;
            }
            
            .pwa-mode .navbar-brand {
                font-size: 0.75rem;
            }
            
            .pwa-mode .btn-sm {
                padding: 0.25rem 0.5rem;
                font-size: 0.8rem;
            }
            
            .pwa-mode .container {
                padding-left: 0.25rem;
                padding-right: 0.25rem;
            }
            
            .pwa-mode main {
                margin-top: 0.25rem;
                padding-bottom: 0.25rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <div class="d-flex align-items-center">
                <img src="/logo" alt="Логотип" class="logo-svg" 
                     style="width: 32px; height: 32px; margin-right: 0.5rem; object-fit: contain;">
                <a class="navbar-brand" href="/">
                    {{ locale.get('app_name', 'Мобильная инвентаризация') }}
                </a>
            </div>
            
            <!-- Мобильная навигация - показывается только на мобильных -->
            {% if user %}
            <div class="d-md-none d-flex align-items-center">
                <a href="/dashboard/{{ user.id }}" class="btn btn-outline-light btn-sm me-2" title="Главная">
                    <i class="bi bi-house"></i>
                </a>
                <a href="/scan/{{ user.id }}" class="btn btn-outline-light btn-sm me-2" title="Сканер" id="scanner-btn">
                    <i class="bi bi-qr-code-scan"></i>
                </a>
                <a href="/" class="btn btn-outline-danger btn-sm me-2" title="Выход" style="border-width: 2px; font-weight: 600;">
                    <i class="bi bi-box-arrow-left"></i>
                </a>
            </div>
            {% endif %}
            
            <div class="d-flex align-items-center">
                <button class="theme-toggle me-2" onclick="toggleFullscreen()" title="Полноэкранный режим">
                    <i class="bi bi-fullscreen" id="fullscreen-icon"></i>
                </button>
                
                <button class="theme-toggle me-2" onclick="toggleTheme()" title="Переключить тему">
                    <i class="bi bi-sun-fill" id="theme-icon"></i>
                </button>
                
                <!-- Переключатель языка -->
                <div class="dropdown me-3">
                    <button class="theme-toggle dropdown-toggle" type="button" data-bs-toggle="dropdown" title="Язык">
                        <i class="bi bi-translate"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                            <form method="post" action="/set_language" class="d-inline">
                                <input type="hidden" name="language" value="ru">
                                <button type="submit" class="dropdown-item">
                                    🇷🇺 Русский
                                </button>
                            </form>
                        </li>
                        <li>
                            <form method="post" action="/set_language" class="d-inline">
                                <input type="hidden" name="language" value="uk">
                                <button type="submit" class="dropdown-item">
                                    🇺🇦 Українська
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
                
                {% if user %}
                <div class="d-flex align-items-center text-white">
                    <i class="bi bi-person-circle me-2"></i>
                    <span class="d-none d-md-inline">{{ user.name }}</span>
                </div>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Индикатор полноэкранного режима -->
    <div class="fullscreen-indicator" onclick="exitFullscreen()" title="Выйти из полноэкранного режима">
        <i class="bi bi-fullscreen-exit"></i>
    </div>

    <main class="container mt-4 fade-in">
        {% block content %}{% endblock %}
    </main>

    <!-- Нижняя навигация - показывается на мобильных в полноэкранном режиме -->
    {% if user %}
    <div class="mobile-nav d-md-block d-none">
        <div class="container">
            <div class="row text-center">
                <div class="col">
                    <a href="/dashboard/{{ user.id }}" class="nav-link">
                        <i class="bi bi-house"></i>
                        <span>Главная</span>
                    </a>
                </div>
                <div class="col">
                    <a href="/scan/{{ user.id }}" class="nav-link">
                        <i class="bi bi-qr-code-scan"></i>
                        <span>Сканер</span>
                    </a>
                </div>
                <div class="col">
                    <a href="/" class="nav-link text-danger fw-bold" style="transition: all 0.3s ease;">
                        <i class="bi bi-box-arrow-left"></i>
                        <span>Выход</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Управление темой
        function toggleTheme() {
            const html = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');
            const currentTheme = html.getAttribute('data-bs-theme');
            
            if (currentTheme === 'dark') {
                html.setAttribute('data-bs-theme', 'light');
                themeIcon.className = 'bi bi-sun-fill';
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-bs-theme', 'dark');
                themeIcon.className = 'bi bi-moon-fill';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Улучшенное управление полноэкранным режимом для Android
        function toggleFullscreen() {
            const fullscreenIcon = document.getElementById('fullscreen-icon');
            const body = document.body;
            
            // Проверяем поддержку различных браузеров
            const requestFullscreen = document.documentElement.requestFullscreen ||
                                    document.documentElement.webkitRequestFullscreen ||
                                    document.documentElement.mozRequestFullScreen ||
                                    document.documentElement.msRequestFullscreen;
            
            const exitFullscreen = document.exitFullscreen ||
                                  document.webkitExitFullscreen ||
                                  document.mozCancelFullScreen ||
                                  document.msExitFullscreen;
            
            const fullscreenElement = document.fullscreenElement ||
                                    document.webkitFullscreenElement ||
                                    document.mozFullScreenElement ||
                                    document.msFullscreenElement;
            
            // Определяем тип устройства
            const isAndroid = /Android/.test(navigator.userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            
            if (isIOS) {
                // На iOS используем viewport meta для имитации полноэкранного режима
                const viewport = document.querySelector('meta[name=viewport]');
                const navbar = document.querySelector('.navbar');
                const mobileTopNav = document.querySelector('.mobile-top-nav');
                
                if (body.classList.contains('fullscreen-mode')) {
                    // Выходим из "полноэкранного" режима
                    body.classList.remove('fullscreen-mode');
                    if (navbar) navbar.style.display = 'block';
                    if (mobileTopNav) mobileTopNav.style.display = 'block';
                    fullscreenIcon.className = 'bi bi-fullscreen';
                    localStorage.setItem('fullscreen', 'false');
                } else {
                    // Входим в "полноэкранный" режим
                    body.classList.add('fullscreen-mode');
                    if (navbar) navbar.style.display = 'none';
                    if (mobileTopNav) mobileTopNav.style.display = 'none';
                    fullscreenIcon.className = 'bi bi-fullscreen-exit';
                    localStorage.setItem('fullscreen', 'true');
                }
                return;
            }
            
            if (!fullscreenElement) {
                // Входим в полноэкранный режим
                if (requestFullscreen) {
                    requestFullscreen.call(document.documentElement).then(() => {
                        fullscreenIcon.className = 'bi bi-fullscreen-exit';
                        body.classList.add('fullscreen-mode');
                        localStorage.setItem('fullscreen', 'true');
                        
                        // Для Android добавляем специальную обработку
                        if (isAndroid) {
                            // Скрываем системную навигацию
                            if (navigator.userAgent.includes('Chrome')) {
                                // Для Chrome на Android
                                document.documentElement.style.overflow = 'hidden';
                            }
                        }
                    }).catch(err => {
                        console.log('Ошибка входа в полноэкранный режим:', err);
                        // Если полноэкранный режим не поддерживается, используем CSS-режим
                        body.classList.add('fullscreen-mode');
                        fullscreenIcon.className = 'bi bi-fullscreen-exit';
                        localStorage.setItem('fullscreen', 'true');
                    });
                } else {
                    // Fallback для браузеров без поддержки полноэкранного режима
                    body.classList.add('fullscreen-mode');
                    fullscreenIcon.className = 'bi bi-fullscreen-exit';
                    localStorage.setItem('fullscreen', 'true');
                }
            } else {
                // Выходим из полноэкранного режима
                if (exitFullscreen) {
                    exitFullscreen.call(document).then(() => {
                        fullscreenIcon.className = 'bi bi-fullscreen';
                        body.classList.remove('fullscreen-mode');
                        localStorage.setItem('fullscreen', 'false');
                        
                        if (isAndroid) {
                            document.documentElement.style.overflow = '';
                        }
                    }).catch(err => {
                        console.log('Ошибка выхода из полноэкранного режима:', err);
                        body.classList.remove('fullscreen-mode');
                        fullscreenIcon.className = 'bi bi-fullscreen';
                        localStorage.setItem('fullscreen', 'false');
                    });
                } else {
                    body.classList.remove('fullscreen-mode');
                    fullscreenIcon.className = 'bi bi-fullscreen';
                    localStorage.setItem('fullscreen', 'false');
                }
            }
        }

        // Функция для выхода из полноэкранного режима
        function exitFullscreen() {
            const fullscreenIcon = document.getElementById('fullscreen-icon');
            const body = document.body;
            
            const exitFullscreen = document.exitFullscreen ||
                                  document.webkitExitFullscreen ||
                                  document.mozCancelFullScreen ||
                                  document.msExitFullscreen;
            
            if (document.fullscreenElement || document.webkitFullscreenElement || 
                document.mozFullScreenElement || document.msFullscreenElement) {
                if (exitFullscreen) {
                    exitFullscreen.call(document).then(() => {
                        fullscreenIcon.className = 'bi bi-fullscreen';
                        body.classList.remove('fullscreen-mode');
                        localStorage.setItem('fullscreen', 'false');
                    }).catch(err => {
                        console.log('Ошибка выхода из полноэкранного режима:', err);
                        body.classList.remove('fullscreen-mode');
                        fullscreenIcon.className = 'bi bi-fullscreen';
                        localStorage.setItem('fullscreen', 'false');
                    });
                }
            } else {
                body.classList.remove('fullscreen-mode');
                fullscreenIcon.className = 'bi bi-fullscreen';
                localStorage.setItem('fullscreen', 'false');
            }
        }

        // Обновление иконки при изменении полноэкранного режима
        document.addEventListener('fullscreenchange', function() {
            const fullscreenIcon = document.getElementById('fullscreen-icon');
            const body = document.body;
            
            if (document.fullscreenElement || document.webkitFullscreenElement || 
                document.mozFullScreenElement || document.msFullscreenElement) {
                fullscreenIcon.className = 'bi bi-fullscreen-exit';
                body.classList.add('fullscreen-mode');
            } else {
                fullscreenIcon.className = 'bi bi-fullscreen';
                body.classList.remove('fullscreen-mode');
            }
        });

        // Предотвращение выхода из полноэкранного режима при навигации на Android
        if (/Android/.test(navigator.userAgent)) {
            // Сохраняем состояние полноэкранного режима
            let wasFullscreen = localStorage.getItem('fullscreen') === 'true';
            
            // Восстанавливаем полноэкранный режим после навигации
            window.addEventListener('pageshow', function() {
                if (wasFullscreen) {
                    setTimeout(() => {
                        const body = document.body;
                        if (!body.classList.contains('fullscreen-mode')) {
                            body.classList.add('fullscreen-mode');
                            const fullscreenIcon = document.getElementById('fullscreen-icon');
                            if (fullscreenIcon) {
                                fullscreenIcon.className = 'bi bi-fullscreen-exit';
                            }
                        }
                    }, 100);
                }
            });
            
            // Предотвращаем выход из полноэкранного режима при фокусе
            document.addEventListener('focusin', function(e) {
                if (wasFullscreen && !e.target.closest('.fullscreen-indicator')) {
                    e.preventDefault();
                }
            });
        }

        // Восстановление темы и полноэкранного режима при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            const savedFullscreen = localStorage.getItem('fullscreen') === 'true';
            const html = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');
            const body = document.body;
            
            html.setAttribute('data-bs-theme', savedTheme);
            themeIcon.className = savedTheme === 'dark' ? 'bi bi-moon-fill' : 'bi bi-sun-fill';
            
            if (savedFullscreen) {
                body.classList.add('fullscreen-mode');
                const fullscreenIcon = document.getElementById('fullscreen-icon');
                if (fullscreenIcon) {
                    fullscreenIcon.className = 'bi bi-fullscreen-exit';
                }
            }
            
            // Подсветка активной страницы в мобильной навигации
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('.mobile-top-nav .nav-link, .mobile-nav .nav-link');
            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                }
            });
        });

        // Предотвращение зума при двойном тапе на iOS
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Предотвращение выхода из полноэкранного режима при скролле на Android
        if (/Android/.test(navigator.userAgent)) {
            let scrollTimeout;
            document.addEventListener('scroll', function() {
                if (document.body.classList.contains('fullscreen-mode')) {
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(() => {
                        // Восстанавливаем полноэкранный режим если он был потерян
                        if (!document.fullscreenElement && !document.webkitFullscreenElement && 
                            !document.mozFullScreenElement && !document.msFullscreenElement) {
                            document.body.classList.add('fullscreen-mode');
                        }
                    }, 100);
                }
            });
        }

        // PWA режим - определение и настройка интерфейса
        function detectPWA() {
            // Проверяем, запущено ли приложение как PWA
            const isPWA = window.matchMedia('(display-mode: standalone)').matches || 
                          window.navigator.standalone === true ||
                          document.referrer.includes('android-app://') ||
                          window.location.search.includes('pwa=true') ||
                          localStorage.getItem('pwa-mode') === 'true';
            
            if (isPWA) {
                console.log('PWA режим обнаружен');
                document.body.classList.add('pwa-mode');
                localStorage.setItem('pwa-mode', 'true');
                
                // Скрываем дублирующую кнопку полноэкранного режима в PWA
                const fullscreenBtn = document.querySelector('button[onclick="toggleFullscreen()"]');
                if (fullscreenBtn) {
                    fullscreenBtn.style.display = 'none';
                    fullscreenBtn.style.visibility = 'hidden';
                    fullscreenBtn.style.opacity = '0';
                    fullscreenBtn.style.width = '0';
                    fullscreenBtn.style.height = '0';
                    fullscreenBtn.style.padding = '0';
                    fullscreenBtn.style.margin = '0';
                    fullscreenBtn.style.border = 'none';
                    fullscreenBtn.style.position = 'absolute';
                    fullscreenBtn.style.left = '-9999px';
                    fullscreenBtn.style.pointerEvents = 'none';
                    fullscreenBtn.classList.add('d-none');
                    fullscreenBtn.setAttribute('aria-hidden', 'true');
                }
                
                // Также скрываем индикатор полноэкранного режима
                const fullscreenIndicator = document.querySelector('.fullscreen-indicator');
                if (fullscreenIndicator) {
                    fullscreenIndicator.style.display = 'none';
                    fullscreenIndicator.style.visibility = 'hidden';
                    fullscreenIndicator.style.opacity = '0';
                    fullscreenIndicator.style.width = '0';
                    fullscreenIndicator.style.height = '0';
                    fullscreenIndicator.style.padding = '0';
                    fullscreenIndicator.style.margin = '0';
                    fullscreenIndicator.style.border = 'none';
                    fullscreenIndicator.style.position = 'absolute';
                    fullscreenIndicator.style.left = '-9999px';
                    fullscreenIndicator.style.pointerEvents = 'none';
                    fullscreenIndicator.classList.add('d-none');
                    fullscreenIndicator.setAttribute('aria-hidden', 'true');
                }
                
                // Автоматически включаем полноэкранный режим в PWA
                if (!document.body.classList.contains('fullscreen-mode')) {
                    document.body.classList.add('fullscreen-mode');
                    const fullscreenIcon = document.getElementById('fullscreen-icon');
                    if (fullscreenIcon) {
                        fullscreenIcon.className = 'bi bi-fullscreen-exit';
                    }
                    localStorage.setItem('fullscreen', 'true');
                }
                

                
                // Предотвращаем выход из полноэкранного режима в PWA
                document.addEventListener('fullscreenchange', function() {
                    if (!document.fullscreenElement && !document.webkitFullscreenElement && 
                        !document.mozFullScreenElement && !document.msFullscreenElement) {
                        // Если вышли из полноэкранного режима, возвращаемся в него
                        setTimeout(() => {
                            if (document.body.classList.contains('pwa-mode')) {
                                document.body.classList.add('fullscreen-mode');
                            }
                        }, 100);
                    }
                });
                
                // В PWA режиме принудительно показываем все элементы
                setTimeout(() => {
                    const barcodeElements = document.querySelectorAll('.barcode-list, .barcode-item, .stats-cards, .card');
                    barcodeElements.forEach(el => {
                        el.style.display = 'block';
                        el.style.visibility = 'visible';
                        el.style.opacity = '1';
                        el.style.maxHeight = 'none';
                        el.style.overflow = 'visible';
                    });
                }, 100);
                
                // Дополнительные проверки для надежности
                setTimeout(() => {
                    // Скрываем кнопку полноэкранного режима еще раз
                    const fullscreenBtn = document.querySelector('button[onclick="toggleFullscreen()"]');
                    if (fullscreenBtn) {
                        fullscreenBtn.style.display = 'none';
                        fullscreenBtn.style.visibility = 'hidden';
                        fullscreenBtn.style.opacity = '0';
                        fullscreenBtn.style.width = '0';
                        fullscreenBtn.style.height = '0';
                        fullscreenBtn.style.padding = '0';
                        fullscreenBtn.style.margin = '0';
                        fullscreenBtn.style.border = 'none';
                        fullscreenBtn.style.position = 'absolute';
                        fullscreenBtn.style.left = '-9999px';
                        fullscreenBtn.style.pointerEvents = 'none';
                    }
                    
                    // Показываем все элементы еще раз
                    const barcodeElements = document.querySelectorAll('.barcode-list, .barcode-item, .stats-cards, .card');
                    barcodeElements.forEach(el => {
                        el.style.display = 'block';
                        el.style.visibility = 'visible';
                        el.style.opacity = '1';
                        el.style.maxHeight = 'none';
                        el.style.overflow = 'visible';
                    });
                }, 500);
                
                // Функция для принудительного скрытия кнопки полноэкранного режима
                function hideFullscreenButton() {
                    const fullscreenBtn = document.querySelector('button[onclick="toggleFullscreen()"]');
                    if (fullscreenBtn) {
                        fullscreenBtn.style.cssText = `
                            display: none !important;
                            visibility: hidden !important;
                            opacity: 0 !important;
                            width: 0 !important;
                            height: 0 !important;
                            padding: 0 !important;
                            margin: 0 !important;
                            border: none !important;
                            position: absolute !important;
                            left: -9999px !important;
                            clip: rect(0, 0, 0, 0) !important;
                            pointer-events: none !important;
                            font-size: 0 !important;
                            line-height: 0 !important;
                        `;
                        fullscreenBtn.classList.add('d-none');
                        fullscreenBtn.setAttribute('aria-hidden', 'true');
                        fullscreenBtn.setAttribute('tabindex', '-1');
                    }
                }
                
                // Запускаем функцию скрытия несколько раз для надежности
                hideFullscreenButton();
                setTimeout(hideFullscreenButton, 100);
                setTimeout(hideFullscreenButton, 500);
                setTimeout(hideFullscreenButton, 1000);
                setTimeout(hideFullscreenButton, 2000);
                
                // Дополнительная функция для полного удаления кнопки из DOM
                function removeFullscreenButton() {
                    const fullscreenBtn = document.querySelector('button[onclick="toggleFullscreen()"]');
                    if (fullscreenBtn) {
                        fullscreenBtn.remove();
                        console.log('Кнопка полноэкранного режима удалена из DOM в PWA режиме');
                    }
                }
                
                // Удаляем кнопку через 3 секунды для надежности
                setTimeout(removeFullscreenButton, 3000);
                
                // Дополнительная функция для принудительного скрытия всех кнопок полноэкранного режима
                function hideAllFullscreenButtons() {
                    const fullscreenButtons = document.querySelectorAll('button[onclick*="toggleFullscreen"], .theme-toggle[onclick*="toggleFullscreen"]');
                    fullscreenButtons.forEach(btn => {
                        btn.style.cssText = `
                            display: none !important;
                            visibility: hidden !important;
                            opacity: 0 !important;
                            width: 0 !important;
                            height: 0 !important;
                            padding: 0 !important;
                            margin: 0 !important;
                            border: none !important;
                            position: absolute !important;
                            left: -9999px !important;
                            clip: rect(0, 0, 0, 0) !important;
                            pointer-events: none !important;
                            font-size: 0 !important;
                            line-height: 0 !important;
                            z-index: -9999 !important;
                        `;
                        btn.classList.add('d-none');
                        btn.setAttribute('aria-hidden', 'true');
                        btn.setAttribute('tabindex', '-1');
                    });
                }
                
                // Запускаем функцию скрытия всех кнопок
                hideAllFullscreenButtons();
                setTimeout(hideAllFullscreenButtons, 100);
                setTimeout(hideAllFullscreenButtons, 500);
                setTimeout(hideAllFullscreenButtons, 1000);
                setTimeout(hideAllFullscreenButtons, 2000);
                setTimeout(hideAllFullscreenButtons, 3000);
                
                // Дополнительная функция для полного удаления всех кнопок полноэкранного режима
                function removeAllFullscreenButtons() {
                    const fullscreenButtons = document.querySelectorAll('button[onclick*="toggleFullscreen"], .theme-toggle[onclick*="toggleFullscreen"]');
                    fullscreenButtons.forEach(btn => {
                        btn.remove();
                        console.log('Кнопка полноэкранного режима удалена из DOM в PWA режиме');
                    });
                }
                
                // Удаляем все кнопки через 5 секунд для надежности
                setTimeout(removeAllFullscreenButtons, 5000);
                
                // Дополнительная функция для принудительного скрытия всех кнопок полноэкранного режима
                function hideAllFullscreenButtonsAggressive() {
                    const fullscreenButtons = document.querySelectorAll('button[onclick*="toggleFullscreen"], .theme-toggle[onclick*="toggleFullscreen"]');
                    fullscreenButtons.forEach(btn => {
                        // Сначала применяем все возможные стили для скрытия
                        btn.style.cssText = `
                            display: none !important;
                            visibility: hidden !important;
                            opacity: 0 !important;
                            width: 0 !important;
                            height: 0 !important;
                            padding: 0 !important;
                            margin: 0 !important;
                            border: none !important;
                            position: absolute !important;
                            left: -9999px !important;
                            clip: rect(0, 0, 0, 0) !important;
                            pointer-events: none !important;
                            font-size: 0 !important;
                            line-height: 0 !important;
                            z-index: -9999 !important;
                            transform: scale(0) !important;
                            transform-origin: center !important;
                        `;
                        
                        // Добавляем все возможные классы для скрытия
                        btn.classList.add('d-none', 'invisible', 'position-absolute');
                        btn.setAttribute('aria-hidden', 'true');
                        btn.setAttribute('tabindex', '-1');
                        btn.setAttribute('data-hidden', 'true');
                        btn.setAttribute('hidden', 'true');
                        
                        // Устанавливаем все возможные атрибуты для скрытия
                        btn.style.setProperty('display', 'none', 'important');
                        btn.style.setProperty('visibility', 'hidden', 'important');
                        btn.style.setProperty('opacity', '0', 'important');
                        btn.style.setProperty('width', '0', 'important');
                        btn.style.setProperty('height', '0', 'important');
                        btn.style.setProperty('padding', '0', 'important');
                        btn.style.setProperty('margin', '0', 'important');
                        btn.style.setProperty('border', 'none', 'important');
                        btn.style.setProperty('position', 'absolute', 'important');
                        btn.style.setProperty('left', '-9999px', 'important');
                        btn.style.setProperty('clip', 'rect(0, 0, 0, 0)', 'important');
                        btn.style.setProperty('pointer-events', 'none', 'important');
                        btn.style.setProperty('font-size', '0', 'important');
                        btn.style.setProperty('line-height', '0', 'important');
                        btn.style.setProperty('z-index', '-9999', 'important');
                        btn.style.setProperty('transform', 'scale(0)', 'important');
                        
                        // В конце удаляем элемент из DOM
                        setTimeout(() => {
                            if (btn.parentNode) {
                                btn.parentNode.removeChild(btn);
                                console.log('Кнопка полноэкранного режима полностью удалена из DOM в PWA режиме');
                            }
                        }, 100);
                    });
                }
                
                // Запускаем максимально агрессивную функцию скрытия и удаления
                hideAllFullscreenButtonsAggressive();
                setTimeout(hideAllFullscreenButtonsAggressive, 100);
                setTimeout(hideAllFullscreenButtonsAggressive, 500);
                setTimeout(hideAllFullscreenButtonsAggressive, 1000);
                setTimeout(hideAllFullscreenButtonsAggressive, 2000);
                setTimeout(hideAllFullscreenButtonsAggressive, 3000);
                setTimeout(hideAllFullscreenButtonsAggressive, 5000);
                setTimeout(hideAllFullscreenButtonsAggressive, 10000);
                
                // Дополнительная функция для непрерывного мониторинга и удаления
                function continuousFullscreenButtonRemoval() {
                    const fullscreenButtons = document.querySelectorAll('button[onclick*="toggleFullscreen"], .theme-toggle[onclick*="toggleFullscreen"]');
                    if (fullscreenButtons.length > 0) {
                        fullscreenButtons.forEach(btn => {
                            btn.remove();
                            console.log('Кнопка полноэкранного режима удалена в непрерывном мониторинге');
                        });
                    }
                }
                
                // Запускаем непрерывный мониторинг каждые 2 секунды
                setInterval(continuousFullscreenButtonRemoval, 2000);
                
                // Добавляем MutationObserver для мониторинга изменений в DOM
                const fullscreenButtonObserver = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'childList') {
                            mutation.addedNodes.forEach(function(node) {
                                if (node.nodeType === Node.ELEMENT_NODE) {
                                    // Проверяем, не является ли добавленный узел кнопкой полноэкранного режима
                                    if (node.matches && node.matches('button[onclick*="toggleFullscreen"], .theme-toggle[onclick*="toggleFullscreen"]')) {
                                        node.remove();
                                        console.log('Новая кнопка полноэкранного режима удалена через MutationObserver');
                                    }
                                    
                                    // Также проверяем дочерние элементы
                                    const fullscreenButtons = node.querySelectorAll ? node.querySelectorAll('button[onclick*="toggleFullscreen"], .theme-toggle[onclick*="toggleFullscreen"]') : [];
                                    fullscreenButtons.forEach(btn => {
                                        btn.remove();
                                        console.log('Дочерняя кнопка полноэкранного режима удалена через MutationObserver');
                                    });
                                }
                            });
                        }
                    });
                });
                
                // Начинаем наблюдение за изменениями в DOM
                fullscreenButtonObserver.observe(document.body, {
                    childList: true,
                    subtree: true
                });
                
                // Функция для непрерывного мониторинга и применения PWA настроек
                function continuousPWASettings() {
                    if (document.body.classList.contains('pwa-mode')) {
                        // Принудительно поддерживаем полноэкранный режим
                        if (!document.body.classList.contains('fullscreen-mode')) {
                            document.body.classList.add('fullscreen-mode');
                        }
                        
                        // Принудительно скрываем все кнопки полноэкранного режима
                        const fullscreenButtons = document.querySelectorAll('button[onclick*="toggleFullscreen"], .theme-toggle[onclick*="toggleFullscreen"]');
                        fullscreenButtons.forEach(btn => {
                            btn.remove();
                        });
                        
                        // Принудительно показываем все элементы штрихкодов
                        const barcodeElements = document.querySelectorAll('.barcode-list, .barcode-item, .stats-cards, .card');
                        barcodeElements.forEach(el => {
                            el.style.cssText = `
                                display: block !important;
                                visibility: visible !important;
                                opacity: 1 !important;
                                max-height: none !important;
                                overflow: visible !important;
                                height: auto !important;
                                min-height: auto !important;
                                clip: auto !important;
                                position: static !important;
                                left: auto !important;
                                top: auto !important;
                                right: auto !important;
                                bottom: auto !important;
                                transform: none !important;
                                filter: none !important;
                                z-index: auto !important;
                                pointer-events: auto !important;
                            `;
                        });
                        

                    }
                }
                
                // Запускаем непрерывный мониторинг PWA настроек каждые 2 секунды
                setInterval(continuousPWASettings, 2000);
            } else {
                // Если не PWA, убираем классы
                document.body.classList.remove('pwa-mode');
                localStorage.removeItem('pwa-mode');
            }
        }

        // Функция для ручного включения PWA режима (для тестирования)
        function enablePWAMode() {
            localStorage.setItem('pwa-mode', 'true');
            detectPWA();
            console.log('PWA режим включен вручную');
        }
        
        // Функция для ручного отключения PWA режима (для тестирования)
        function disablePWAMode() {
            localStorage.removeItem('pwa-mode');
            document.body.classList.remove('pwa-mode');
            console.log('PWA режим отключен вручную');
        }
        
        // Запускаем определение PWA режима при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            detectPWA();
        });
        
        // Также запускаем при изменении видимости страницы (например, при возврате из фона)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                setTimeout(detectPWA, 100);
            }
        });
        
        // Запускаем определение PWA режима каждые 5 секунд для надежности
        setInterval(detectPWA, 5000);
        
        // Дополнительные методы определения PWA режима
        function detectPWAAdvanced() {
            // Проверяем различные признаки PWA
            const isPWA = 
                window.matchMedia('(display-mode: standalone)').matches ||
                window.navigator.standalone === true ||
                document.referrer.includes('android-app://') ||
                window.location.search.includes('pwa=true') ||
                localStorage.getItem('pwa-mode') === 'true' ||
                window.location.protocol === 'https:' && window.location.hostname !== 'localhost' ||
                window.navigator.userAgent.includes('Mobile') && window.navigator.userAgent.includes('Safari') ||
                window.navigator.userAgent.includes('Android') && window.navigator.userAgent.includes('Chrome');
            
            if (isPWA) {
                console.log('PWA режим обнаружен расширенными методами');
                document.body.classList.add('pwa-mode');
                localStorage.setItem('pwa-mode', 'true');
                
                // Принудительно применяем PWA настройки
                setTimeout(() => {
                    continuousPWASettings();
                    hideAllFullscreenButtonsAggressive();
                }, 100);
            }
        }
        
        // Запускаем расширенное определение PWA режима
        setTimeout(detectPWAAdvanced, 2000);
        setInterval(detectPWAAdvanced, 10000);

        // Горячие клавиши для тестирования PWA режима (Ctrl+Shift+P)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                e.preventDefault();
                if (document.body.classList.contains('pwa-mode')) {
                    disablePWAMode();
                } else {
                    enablePWAMode();
                }
            }
        });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>